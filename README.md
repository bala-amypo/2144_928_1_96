# Leave Overlap - Team Capacity Analyzer

A Spring Boot application for managing employee leave requests and analyzing team capacity to prevent understaffing.

## Features

- Employee profile management
- Leave request submission and approval workflow
- Team capacity configuration and monitoring
- Capacity analysis with risk assessment
- JWT-based authentication and authorization
- RESTful APIs with Swagger documentation

## Technology Stack

- **Framework**: Spring Boot 3.2.0
- **Database**: MySQL with Hibernate/JPA
- **Security**: JWT tokens, BCrypt password encoding
- **Documentation**: Swagger/OpenAPI 3
- **Testing**: TestNG, Mockito
- **Build Tool**: Maven

## Project Structure

```
src/main/java/com/example/demo/
├── config/           # Configuration classes
├── controller/       # REST controllers
├── dto/             # Data Transfer Objects
├── exception/       # Custom exceptions
├── model/           # JPA entities
├── repository/      # Data access layer
├── security/        # JWT and security components
├── service/         # Business logic interfaces
├── service/impl/    # Service implementations
├── servlet/         # Simple servlet implementation
├── util/           # Utility classes
└── DemoApplication.java
```

## Key Components

### Entities
- **EmployeeProfile**: Core employee information with many-to-many colleague relationships
- **LeaveRequest**: Leave applications with approval workflow
- **TeamCapacityConfig**: Team-specific capacity rules and thresholds
- **UserAccount**: Authentication credentials with BCrypt password hashing
- **CapacityAlert**: Low-capacity warnings generated by analysis

### Services
- **EmployeeProfileService**: CRUD operations for employee management
- **LeaveRequestService**: Leave request lifecycle management
- **CapacityAnalysisService**: Team capacity analysis and risk assessment
- **AuthService**: JWT-based authentication
- **TeamCapacityRuleService**: Capacity configuration management

### Security
- JWT token-based authentication
- BCrypt password encoding
- Role-based authorization
- Stateless session management

## API Endpoints

### Authentication
- `POST /auth/login` - User authentication
- `POST /auth/register` - User registration

### Employee Management
- `GET /api/employees` - List all employees
- `GET /api/employees/{id}` - Get employee by ID
- `GET /api/employees/team/{teamName}` - Get employees by team
- `POST /api/employees` - Create new employee
- `PUT /api/employees/{id}` - Update employee

### Leave Management
- `POST /api/leaves` - Submit leave request
- `PUT /api/leaves/{id}/approve` - Approve leave
- `PUT /api/leaves/{id}/reject` - Reject leave
- `GET /api/leaves/employee/{employeeId}` - Get leaves by employee
- `GET /api/leaves/team-overlap` - Get overlapping leaves for team

### Capacity Management
- `POST /api/capacity-rules` - Create capacity rule
- `PUT /api/capacity-rules/{id}` - Update capacity rule
- `GET /api/capacity-rules/team/{teamName}` - Get rule by team
- `POST /api/capacity-alerts/analyze` - Analyze team capacity
- `GET /api/capacity-alerts/team/{teamName}` - Get alerts by team

## Database Configuration

Update `application.properties` with your MySQL database settings:

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/leave_capacity_db
spring.datasource.username=your_username
spring.datasource.password=your_password
```

## Running the Application

1. Ensure MySQL is running and create the database
2. Update database configuration in `application.properties`
3. Run the application:
   ```bash
   mvn spring-boot:run
   ```
4. Access Swagger UI at: `http://localhost:8080/swagger-ui.html`

## Testing

The project includes comprehensive TestNG tests covering:
- Servlet functionality
- CRUD operations
- Dependency injection
- Hibernate/JPA operations
- Many-to-many relationships
- Security and JWT
- HQL queries and capacity analysis

Run tests with:
```bash
mvn test
```

## Key Features

### Capacity Analysis
- Calculates daily team capacity based on approved leaves
- Generates alerts when capacity falls below configured thresholds
- Supports date range analysis for planning purposes

### Leave Management
- Complete leave request lifecycle (submit, approve, reject)
- Validation for date ranges and employee existence
- Overlapping leave detection for team analysis

### Security
- JWT tokens with user ID, email, and role claims
- BCrypt password hashing
- Stateless authentication suitable for REST APIs

## Architecture Highlights

- **Service Layer Validation**: All business rules implemented in services, not controllers
- **DTO Pattern**: Clean separation between API contracts and internal entities
- **Repository Pattern**: JPA repositories with custom query methods
- **Exception Handling**: Global exception handler for consistent error responses
- **Many-to-Many Relationships**: Employee colleague associations
- **Normalization**: Database design follows 1NF, 2NF, and 3NF principles